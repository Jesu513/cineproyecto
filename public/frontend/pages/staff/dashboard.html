<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Staff ‚Äì Dashboard</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-slate-900 text-white">

    <div class="flex">

        <!-- SIDEBAR -->
        <aside class="w-64 bg-slate-800 h-screen p-5 space-y-6 border-r border-slate-700">

            <h2 class="text-2xl font-bold mb-4">üé´ Staff</h2>

            <nav class="space-y-3">
                <a href="dashboard.html"
                    class="block px-3 py-2 rounded bg-sky-600 text-white font-semibold">
                    üìä Dashboard
                </a>

                <a href="validate-booking.html"
                    class="block px-3 py-2 rounded hover:bg-slate-700">
                    üîç Validar Reservas
                </a>

                <a href="manual-booking.html"
                    class="block px-3 py-2 rounded hover:bg-slate-700">
                    üìù Reserva Manual
                </a>
            </nav>

        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 p-10 space-y-10">

            <h1 class="text-4xl font-bold mb-6">üìä Panel de Staff</h1>

            <!-- CARDS SUPERIORES -->
            <div id="statCards" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

            <!-- RESERVAS DEL D√çA -->
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
                <h2 class="text-2xl font-semibold mb-4">üóìÔ∏è Reservas del D√≠a</h2>
                <table class="w-full text-left">
                    <thead>
                        <tr class="border-b border-slate-600">
                            <th class="p-3">C√≥digo</th>
                            <th class="p-3">Cliente</th>
                            <th class="p-3">Pel√≠cula</th>
                            <th class="p-3">Hora</th>
                            <th class="p-3">Estado</th>
                        </tr>
                    </thead>
                    <tbody id="reservationsTable"></tbody>
                </table>
            </div>

            <!-- FUNCIONES DEL D√çA -->
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
                <h2 class="text-2xl font-semibold mb-4">üé• Funciones del D√≠a</h2>
                <div id="showtimesList" class="space-y-4"></div>
            </div>

        </main>

    </div>

    <script src="../../utils/api.js"></script>

    <script type="text/babel">

        // =========================================
        // 1. Cargar estad√≠sticas del d√≠a
        // =========================================

        async function loadStats() {
            const res = await api.get("/staff/stats");

            const stats = res.data || {
                total_reservations: 0,
                confirmed: 0,
                pending: 0
            };

            const cards = [
                {
                    label: "Reservas Totales",
                    value: stats.total_reservations,
                    color: "bg-sky-600"
                },
                {
                    label: "Confirmadas",
                    value: stats.confirmed,
                    color: "bg-emerald-600"
                },
                {
                    label: "Pendientes",
                    value: stats.pending,
                    color: "bg-yellow-500"
                }
            ];

            const container = document.getElementById("statCards");
            container.innerHTML = "";

            cards.forEach(c => {
                const card = document.createElement("div");
                card.className = "p-6 rounded-xl shadow-lg border border-slate-700 bg-slate-800";

                card.innerHTML = `
                    <div class="text-sm text-slate-400">${c.label}</div>
                    <div class="text-4xl font-bold mt-2">${c.value}</div>
                `;

                container.appendChild(card);
            });
        }

        // =========================================
        // 2. Reservas del d√≠a
        // =========================================

        async function loadTodayReservations() {
            const res = await api.get("/staff/today-reservations");
            const list = res.data || [];

            const tbody = document.getElementById("reservationsTable");
            tbody.innerHTML = "";

            list.forEach(r => {
                const tr = document.createElement("tr");
                tr.className = "border-b border-slate-700";

                const statusColor =
                    r.status === "confirmed" ? "text-emerald-400" :
                    r.status === "pending" ? "text-yellow-400" :
                    "text-red-400";

                tr.innerHTML = `
                    <td class="p-3 font-semibold">${r.booking_code}</td>
                    <td class="p-3">${r.customer_name}</td>
                    <td class="p-3">${r.movie_title}</td>
                    <td class="p-3">${r.show_time}</td>
                    <td class="p-3 ${statusColor} font-bold">${r.status}</td>
                `;

                tbody.appendChild(tr);
            });
        }

        // =========================================
        // 3. Funciones del d√≠a
        // =========================================

        async function loadTodayShowtimes() {
            const res = await api.get("/staff/showtimes/today");
            const list = res.data || [];

            const container = document.getElementById("showtimesList");
            container.innerHTML = "";

            list.forEach(s => {
                const box = document.createElement("div");
                box.className = "p-4 bg-slate-700 rounded-lg border border-slate-600 flex justify-between";

                const occupancy = Math.round((s.occupied / s.capacity) * 100);

                box.innerHTML = `
                    <div>
                        <div class="font-bold text-lg">${s.movie_title}</div>
                        <div class="text-sm text-slate-300">Sala: ${s.room_name}</div>
                        <div class="text-sm text-slate-300">Hora: ${s.show_time}</div>
                    </div>

                    <div class="text-right">
                        <div class="text-sm text-slate-400">Ocupaci√≥n</div>
                        <div class="text-xl font-bold">${occupancy}%</div>
                    </div>
                `;

                container.appendChild(box);
            });
        }

        // =========================================
        // Inicializar panel
        // =========================================

        loadStats();
        loadTodayReservations();
        loadTodayShowtimes();

    </script>

</body>
</html>
